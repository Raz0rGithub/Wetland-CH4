<!DOCTYPE html>
<html lang="en-US" style="background: #00313c">

<head>
    <title>LBNL | Methane Emissions Visualizer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8" />
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" sizes="16x16 32x32 48x48" type="image/png" href="/images/favicon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
        rel="stylesheet">
    <script src='https://cdn.jsdelivr.net/npm/mapbox-gl/dist/mapbox-gl.min.js'></script>
    <link href='https://cdn.jsdelivr.net/npm/mapbox-gl/dist/mapbox-gl.css' rel='stylesheet' />
</head>

<body class="layout-basic">
    <header id="trueheader">
    </header>

    <main class=content id="nopadding">
        <header>
            <h2 id="title">Mean FCH4 (total and yearly)</h2>
        </header>
        <!-- TIMELINE START -->
        <section class="cd-h-timeline js-cd-h-timeline margin-bottom-md">
            <div class="cd-h-timeline__container container">
                <div class="cd-h-timeline__dates">
                    <div class="cd-h-timeline__line">
                        <ol>
                            <li><a href="#0" data-date="01/01/2011"
                                    class="cd-h-timeline__date cd-h-timeline__date--selected"
                                    id="victor-chen/clzrv1q5g00bg01r82uyjes92">total
                                </a></li>
                            <li><a href="#0" data-date="01/01/2012" class="cd-h-timeline__date"
                                    id="victor-chen/cm07v6kot00nb01psgvxme3om">2012
                                </a></li>
                            <li><a href="#0" data-date="01/01/2013" class="cd-h-timeline__date"
                                    id="victor-chen/cm07vdyd800lv01rb7aztfs7b">2013</a></li>
                            <li><a href="#0" data-date="01/01/2014" class="cd-h-timeline__date"
                                    id="victor-chen/cm07ve2ra00li01pw96r92cak">2014</a></li>
                            <li><a href="#0" data-date="01/01/2015" class="cd-h-timeline__date"
                                    id="victor-chen/cm07ve6oz00d301omev1lbtw9">2015</a></li>
                            <li><a href="#0" data-date="01/01/2016" class="cd-h-timeline__date"
                                    id="victor-chen/cm07vecsg00d401omar1f1m17">2016</a></li>
                            <li><a href="#0" data-date="01/01/2017" class="cd-h-timeline__date"
                                    id="victor-chen/cm07vefpx00d501om8cvmb9e7">2017</a></li>
                            <li><a href="#0" data-date="01/01/2018" class="cd-h-timeline__date"
                                    id="victor-chen/cm07vel3c00lj01pw1osv1jaj">2018</a></li>
                            <li><a href="#0" data-date="01/01/2019" class="cd-h-timeline__date"
                                    id="victor-chen/cm07venvr00me01pndpwh0sjs">2019</a></li>
                            <li><a href="#0" data-date="01/01/2020" class="cd-h-timeline__date"
                                    id="victor-chen/cm07vg9bd00nc01psduujd5v5">2020</a></li>
                            <li><a href="#0" data-date="01/01/2021" class="cd-h-timeline__date"
                                    id="victor-chen/cm07vgcuk00d601omei6c4e06">2021</a></li>
                            <li><a href="#0" data-date="01/01/2022" class="cd-h-timeline__date"
                                    id="victor-chen/cm07vgekh00d701oma8t94ruk">2022</a></li>
                            <li><a href="#0" data-date="01/01/2023" class="cd-h-timeline__date"
                                    id="victor-chen/cm07vhkcz00mf01pn1xro8spp">2023</a></li>
                        </ol>

                        <span class="cd-h-timeline__filling-line" aria-hidden="true"></span>
                    </div> <!-- .cd-h-timeline__line -->
                </div> <!-- .cd-h-timeline__dates -->

                <ul>
                    <li><a href="#0"
                            class="text-replace cd-h-timeline__navigation cd-h-timeline__navigation--prev cd-h-timeline__navigation--inactive">Prev</a>
                    </li>
                    <li><a href="#0"
                            class="text-replace cd-h-timeline__navigation cd-h-timeline__navigation--next">Next</a>
                    </li>
                </ul>
            </div> <!-- .cd-h-timeline__container -->

            <div class="cd-h-timeline__events">
                <ol>
                    <li class="cd-h-timeline__event cd-h-timeline__event--selected text-component">
                    </li>
                    <li class="cd-h-timeline__event text-component">
                    </li>
                    <li class="cd-h-timeline__event text-component">
                    </li>
                    <li class="cd-h-timeline__event text-component">
                    </li>
                    <li class="cd-h-timeline__event text-component">
                    </li>
                    <li class="cd-h-timeline__event text-component">
                    </li>
                    <li class="cd-h-timeline__event text-component">
                    </li>
                    <li class="cd-h-timeline__event text-component">
                    </li>
                    <li class="cd-h-timeline__event text-component">
                    </li>
                    <li class="cd-h-timeline__event text-component">
                    </li>
                    <li class="cd-h-timeline__event text-component">
                    </li>
                    <li class="cd-h-timeline__event text-component">
                    </li>
                    <li class="cd-h-timeline__event text-component">
                    </li>
                </ol>
            </div> <!-- .cd-h-timeline__events -->
        </section>
        <script src="assets/js/util.js"></script> <!-- util functions included in the CodyHouse framework -->
        <script src="assets/js/swipe-content.js"></script>
        <script src="assets/js/main.js"></script> <!-- A Vanilla JavaScript plugin to detect touch interactions -->
        <script>document.getElementsByTagName("html")[0].className += " js";</script>
        <link rel="stylesheet" href="assets/css/style.css">
        <!-- TIMELINE END -->

        <!-- COUNTER -->
        <div id="visits">
            Page Load Counter(uninitialized)
        </div>

        <!-- MAP -->
        <img src="./images/colorbar.svg" alt="A colorbar going from blue to pink depicting the FCH4 values on the map"
            id="colorbar" />
        <div id='map' style='width: 100%; height: 82vh;'></div>

        <!-- Page Load Counter-->
        <script>
            var response;
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://count.cab/hit/Qh87WE1hyK/KEY3d772ba1b571");
            xhr.responseType = "basic";
            xhr.onload = function () {
                response = JSON.parse(this.responseText);
                document.getElementById('visits').innerText = "Page Load Counter: " + response.count;

                if (response.count < 50000) {
                    loadmap();
                }
                else {
                    document.getElementById('visits').innerText = "This 3d Earth Render has exceed it's monthly load count of 50,000 loads. Please check back at the beginning of next month.";
                    document.getElementById('visits').style.color = "#000";
                    document.getElementById('visits').style.translate = "0 0";
                    document.getElementById('colorbar').style.display = "none";
                }
            }
            xhr.send();
        </script>

        <!-- Load map function -->
        <script>
            function loadmap() {
                mapboxgl.accessToken = 'pk.eyJ1IjoidmljdG9yLWNoZW4iLCJhIjoiY2x6bjRmZ2RkMGplZzJrcHhxaGdkejBiMCJ9.M16aiudcdcItWjvTfoFMhw';
                const map = new mapboxgl.Map({
                    container: 'map', // container ID
                    style: 'mapbox://styles/victor-chen/clzrv1q5g00bg01r82uyjes92', // style URL
                    center: [-90, 20], // starting position [lng, lat]
                    zoom: 2, // starting zoom
                    logoPosition: "bottom-right"
                });

                map.addControl(new mapboxgl.NavigationControl());
                map.addControl(new mapboxgl.FullscreenControl());

                const inputs = document.getElementsByTagName('input');

                for (const input of inputs) {
                    input.onclick = (layer) => {
                        const layerId = layer.target.id;
                        map.setStyle('mapbox://styles/' + layerId);
                    };
                }

                // The following values can be changed to control rotation speed:
                // At low zooms, complete a revolution every two minutes.
                const secondsPerRevolution = 60;
                // Above zoom level 5, do not rotate.
                const maxSpinZoom = 3;
                // Rotate at intermediate speeds between zoom levels 3 and 5.
                const slowSpinZoom = 2;

                let userInteracting = false;
                let spinEnabled = true;

                function spinGlobe() {
                    const zoom = map.getZoom();
                    if (spinEnabled && !userInteracting && zoom < maxSpinZoom) {
                        let distancePerSecond = 360 / secondsPerRevolution;
                        if (zoom > slowSpinZoom) {
                            // Slow spinning at higher zooms
                            const zoomDif =
                                (maxSpinZoom - zoom) / (maxSpinZoom - slowSpinZoom);
                            distancePerSecond *= zoomDif;
                        }
                        const center = map.getCenter();
                        center.lng -= distancePerSecond;
                        // Smoothly animate the map over one second.
                        // When this animation is complete, it calls a 'moveend' event.
                        map.easeTo({ center, duration: 1000, easing: (n) => n });
                    }
                }

                // Pause spinning on interaction
                map.on('mousedown', () => {
                    userInteracting = true;
                });

                // Restart spinning the globe when interaction is complete
                map.on('mouseup', () => {
                    userInteracting = false;
                    spinGlobe();
                });

                // These events account for cases where the mouse has moved
                // off the map, so 'mouseup' will not be fired.
                map.on('dragend', () => {
                    userInteracting = false;
                    spinGlobe();
                });
                map.on('pitchend', () => {
                    userInteracting = false;
                    spinGlobe();
                });
                map.on('rotateend', () => {
                    userInteracting = false;
                    spinGlobe();
                });

                // When animation is complete, start spinning if there is no ongoing interaction
                map.on('moveend', () => {
                    spinGlobe();
                });

                document.getElementById('btn-spin').addEventListener('click', (e) => {
                    spinEnabled = !spinEnabled;
                    if (spinEnabled) {
                        spinGlobe();
                        e.target.innerHTML = 'Pause rotation';
                    } else {
                        map.stop(); // Immediately end ongoing animation
                        e.target.innerHTML = 'Start rotation';
                    }
                });
                spinGlobe();
            }
        </script>
    </main>

    <footer id="truefooter">
        <!-- <address>
            Written by <a href="VictorChen@lbl.gov">Victor Chen</a>.<br>
        </address> -->
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js" defer></script>
    <script type="text/javascript" src="./script.js" defer></script>

</body>

</html>