<!DOCTYPE html>
<html lang="en-US" style="background: #00313c">

<head>
    <title>LBNL | Methane Emissions Visualizer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8" />
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" sizes="16x16 32x32 48x48" type="image/png" href="/images/favicon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
        rel="stylesheet">
    <script src='https://cdn.jsdelivr.net/npm/mapbox-gl/dist/mapbox-gl.min.js'></script>
    <link href='https://cdn.jsdelivr.net/npm/mapbox-gl/dist/mapbox-gl.css' rel='stylesheet' />
    <!-- <script src='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js'></script>
    <link href='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css' rel='stylesheet' /> -->
</head>

<body class="layout-basic">
    <header id="trueheader">
    </header>

    <main class=content id="nopadding">
        <header><!-- <h1>Global Wetland CH4 Upscaling Dataset</h1> --></header>

        <div class="radio-inputs">
            <label class="radio">
                <input id="victor-chen/clzqakx8u008s01ra76xc744p" type="radio" name="rtoggle" value="mean"
                    checked="checked">
                <div class="name" for="victor-chen/clzqakx8u008s01ra76xc744p">mean</div>
            </label>
            <label class="radio">
                <input id="victor-chen/clzrv1q5g00bg01r82uyjes92" type="radio" name="rtoggle" value="mean-zeroed">
                <div class="name" for="victor-chen/clzrv1q5g00bg01r82uyjes92">mean-zeroed</div>
            </label>
            <label class="radio">
                <input id="mapbox/outdoors-v12" type="radio" name="rtoggle" value="test">
                <div class="name" for="mapbox/outdoors-v12">test</div>
            </label>
        </div>

        <div id='map' style='width: 100%; height: 82vh;'></div>

        <script>
            mapboxgl.accessToken = 'pk.eyJ1IjoidmljdG9yLWNoZW4iLCJhIjoiY2x6bjRmZ2RkMGplZzJrcHhxaGdkejBiMCJ9.M16aiudcdcItWjvTfoFMhw';
            const map = new mapboxgl.Map({
                container: 'map', // container ID
                style: 'mapbox://styles/victor-chen/clzqakx8u008s01ra76xc744p', // style URL
                center: [-90, 20], // starting position [lng, lat]
                zoom: 2 // starting zoom
            });

            map.addControl(new mapboxgl.NavigationControl());
            map.addControl(new mapboxgl.FullscreenControl());
            const inputs = document.getElementsByTagName('input');

            for (const input of inputs) {
                input.onclick = (layer) => {
                    const layerId = layer.target.id;
                    map.setStyle('mapbox://styles/' + layerId);
                };
            }
        </script>
        <script>
            // The following values can be changed to control rotation speed:

            // At low zooms, complete a revolution every two minutes.
            const secondsPerRevolution = 90;
            // Above zoom level 5, do not rotate.
            const maxSpinZoom = 4;
            // Rotate at intermediate speeds between zoom levels 3 and 5.
            const slowSpinZoom = 3;

            let userInteracting = false;
            let spinEnabled = true;

            function spinGlobe() {
                const zoom = map.getZoom();
                if (spinEnabled && !userInteracting && zoom < maxSpinZoom) {
                    let distancePerSecond = 360 / secondsPerRevolution;
                    if (zoom > slowSpinZoom) {
                        // Slow spinning at higher zooms
                        const zoomDif =
                            (maxSpinZoom - zoom) / (maxSpinZoom - slowSpinZoom);
                        distancePerSecond *= zoomDif;
                    }
                    const center = map.getCenter();
                    center.lng -= distancePerSecond;
                    // Smoothly animate the map over one second.
                    // When this animation is complete, it calls a 'moveend' event.
                    map.easeTo({ center, duration: 1000, easing: (n) => n });
                }
            }

            // Pause spinning on interaction
            map.on('mousedown', () => {
                userInteracting = true;
            });

            // Restart spinning the globe when interaction is complete
            map.on('mouseup', () => {
                userInteracting = false;
                spinGlobe();
            });

            // These events account for cases where the mouse has moved
            // off the map, so 'mouseup' will not be fired.
            map.on('dragend', () => {
                userInteracting = false;
                spinGlobe();
            });
            map.on('pitchend', () => {
                userInteracting = false;
                spinGlobe();
            });
            map.on('rotateend', () => {
                userInteracting = false;
                spinGlobe();
            });

            // When animation is complete, start spinning if there is no ongoing interaction
            map.on('moveend', () => {
                spinGlobe();
            });

            document.getElementById('btn-spin').addEventListener('click', (e) => {
                spinEnabled = !spinEnabled;
                if (spinEnabled) {
                    spinGlobe();
                    e.target.innerHTML = 'Pause rotation';
                } else {
                    map.stop(); // Immediately end ongoing animation
                    e.target.innerHTML = 'Start rotation';
                }
            });
        </script>

        <!-- <div id="home">
            Counter(uninitialized)
        </div> -->

    </main>

    <footer id="truefooter">
        <!-- <address>
            Written by <a href="VictorChen@lbl.gov">Victor Chen</a>.<br>
        </address> -->
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js" defer></script>
    <script type="text/javascript" src="./script.js" defer></script>
    <script>spinGlobe()</script>

</body>

</html>